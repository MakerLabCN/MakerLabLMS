= render 'guides/show/guide_sidebar'
= render 'topics/show/manage'

- content_for :template_js do
  :plain
    var creating_comment = false;

    $("textarea#comment_content").keydown(function(e) {
      if (e.ctrlKey && e.keyCode == 13) {
        if (creating_comment) return;
        creating_comment = true
        $("input[type=submit]").click();
      }
    });

- article_user = @article.cached_assoc_object(:user)

.box
  %article
    .header
      .pull-right
        = user_profile_avatar_link(article_user, :large)
      = build_navigation([link_to("学习系统", guides_path, :class => :rabel),link_to(@guide.category.title, "#{guides_url}?c=#{@guide.category.id}", :class => :rabel),@guide.title], 'bigger')
      .sep10
      %h1#topic_title
        = Rabel::Base.make_mention_links(Rabel::Base.h(@article.title)).html_safe
      %small.topic-meta
        By
        = user_profile_link(article_user, :class => :dark)
        at
        = time_ago_in_words(@article.created_at)
        ,
        = @article.hit
        次浏览
      .clearfix
    .inner
      .content.topic_content= format_topic(@article.content)
    .inner
      - if @next_article.present?
        .pull-right
          = link_to proper_length(@next_article.title, 15), @next_article, :class => :rabel, :rel => :prev
          %span.guillemet.right-guillemet »

      - if @prev_article.present?
        .pull-left
          %span.guillemet.left-guillemet «
          = link_to proper_length(@prev_article.title, 15), @prev_article, :class => :rabel, :rel => :next
      .clearfix

  = render 'shared/box_tip', :tip => "本文最后更新于：" + time_ago_in_words(@guide.updated_at)
= render 'articles/show/comments' if @comments.any?

- if @article.comments_closed?
  = render 'shared/box_tip', :tip => t('tips.comments_closed')
- elsif @comments.empty?
  = render 'shared/box_tip', :tip => '目前尚无回复'

= render 'articles/show/comment_form' unless @article.comments_closed?
